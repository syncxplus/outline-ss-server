FROM docker.elastic.co/logstash/logstash:6.5.4

LABEL maintainer="jibo@outlook.com"

RUN /usr/share/logstash/bin/logstash-plugin install logstash-input-journald

COPY logstash.conf /data/logstash.conf

COPY logstash.yml /usr/share/logstash/config/logstash.yml

CMD ["logstash", "-f", "/data/logstash.conf"]

USER root

RUN usermod -g root logstash

USER logstash

# Build: docker build . -f logstash -t syncxplus/logstash:shadowbox2
# Config: [[ ! -f "${PWD}/logstash/logstash.conf" ]] && mkdir ${PWD}/logstash;curl -L https://raw.githubusercontent.com/syncxplus/outline-ss-server/ufo/logstash.conf -o ${PWD}/logstash/logstash.conf;docker run -u root --rm -v ${PWD}/logstash:/data syncxplus/logstash:shadowbox2 chown -R logstash:logstash /data
# Usage: docker run --name logstash --net host --restart=always --log-driver json-file --log-opt max-size=10m -v ${PWD}/logstash:/data -v /var/log/journal:/var/log/journal -e HOST_IP=`curl -s checkip.amazonaws.com` -e ELASTIC_SEARCH_URL=http://54.146.25.16:9200 -d syncxplus/logstash:shadowbox2
